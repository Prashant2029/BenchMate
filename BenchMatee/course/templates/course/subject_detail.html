<h1>{{ subject.name }}</h1>

<h2>Chapters</h2>
<ul>
    {% for ch in chapters %}
    <li>
        {{ ch.title }} - Progress: {{ ch.progress }}%
        {% if ch.content_file %}
            <a href="{{ ch.content_file }}" target="_blank">Read Summary</a>
        {% endif %}
        <button onclick="attemptQuiz({{ ch.id }})">Attempt Quiz</button>
    </li>
    {% endfor %}
</ul>

<h2>Chatbot</h2>
<div id="chat-box">
    <div id="messages"></div>
    <input type="text" id="user-msg" placeholder="Ask something about {{ subject.name }}">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
function sendMessage() {
    const msg = document.getElementById('user-msg').value;
    fetch("{% url 'subject_chat' subject.id %}", {
        method: "POST",
        headers: {'X-CSRFToken': '{{ csrf_token }}', 'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'message=' + encodeURIComponent(msg)
    }).then(res => res.json()).then(data => {
        const messages = document.getElementById('messages');
        messages.innerHTML += '<p><b>You:</b> '+ msg + '</p>';
        messages.innerHTML += '<p><b>Tutor:</b> '+ data.reply + '</p>';
    });
}
</script>
