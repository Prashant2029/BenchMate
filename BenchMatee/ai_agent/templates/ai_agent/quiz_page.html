<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; background: #f4f6f9; margin:0; }
.container { max-width: 900px; margin:40px auto; background:white; padding:30px; border-radius:12px; }
textarea { width:100%; padding:12px; border-radius:6px; border:1px solid #ccc; resize: vertical; font-size:16px; }
button { background:#4a6cf7; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-size:16px; }
button:hover { background:#3a52c7; }
.question-card { margin-bottom:20px; padding:15px; background:#f9fafc; border-left:5px solid #4a6cf7; border-radius:6px; }
.options label { display:block; margin-bottom:8px; cursor:pointer; }
.correct { color:green; font-weight:bold; }
.wrong { color:red; font-weight:bold; }
.loading { font-weight:bold; color:#4a6cf7; margin-top:15px; text-align:center; }
</style>
</head>
<body>
<div class="container">
<h1>Interactive Quiz</h1>

<!-- Step 1: Content -->
{% if error %}
<p style="color:red">{{ error }}</p>
{% endif %}

<div id="content-section" {% if quizzes %}style="display:none"{% endif %}>
    <form id="generate-form" method="post">
        {% csrf_token %}
        <textarea name="content" rows="8" placeholder="Paste your content here (min 50 words)"></textarea><br>
        <button type="submit">Generate Quiz</button>
        <div id="loading" class="loading" style="display:none">Generating quiz, please wait...</div>
    </form>
</div>

<!-- Step 2: Quiz -->
{% if quizzes %}
<form method="post">
    {% csrf_token %}
    <input type="hidden" name="submit_quiz" value="1">
    {% for quiz in quizzes %}
    <div class="question-card">
        <p><b>Q{{ forloop.counter }}:</b> {{ quiz.question }}</p>
        <div class="options">
            {% for opt in quiz.options %}
            <label><input type="radio" name="question_{{ quiz.id }}" value="{{ opt }}"> {{ opt }}</label>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    <button type="submit">Submit Quiz</button>
</form>
{% endif %}

<!-- Step 3: Results -->
{% if results %}
<h2>Your Score: {{ score }} / {{ total }}</h2>
<ol>
    {% for r in results %}
    <li>
        {{ r.question }}<br>
        Your answer: <span class="{% if r.is_correct %}correct{% else %}wrong{% endif %}">{{ r.selected }}</span><br>
        Correct answer: {{ r.correct }}
    </li>
    {% endfor %}
</ol>
<form method="get">
    <button type="submit">Try Another Content</button>
</form>
{% endif %}

</div>

<script>
document.getElementById("generate-form")?.addEventListener("submit", function(){
    document.getElementById("loading").style.display = "block";
});
</script>
</body>
</html>
